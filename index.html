<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Music Video Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="index.css" />
    <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.run/@google/genai",
          "safevalues/dom": "https://cdn.jsdelivr.net/npm/safevalues@1.2.0/dist/mjs/dom/index.js",
          "safevalues/": "https://aistudiocdn.com/safevalues@^1.2.0/",
          "safevalues": "https://cdn.jsdelivr.net/npm/safevalues@^1.2.0/dist/mjs/index.min.js"
        }
      }
    </script>
  </head>
  <body>
    <div class="container">
      <header class="app-header">
        <img
          id="app-logo"
          class="app-logo"
          alt="AI Music Video Generator Logo"
        />
        <h1>AI Music Video Generator</h1>
        <p>Your complete toolkit for audio analysis and music video creation.</p>
      </header>
      <main class="app-main">
        <div class="controls-panel">
          <section class="control-section">
            <h2 class="section-title">
              <span class="step-number">1</span> Upload & Analyze
            </h2>
            <div class="control-group">
              <label for="audio-upload" class="file-upload-label">
                <i class="fa-solid fa-cloud-arrow-up"></i> Choose Audio File
              </label>
              <input type="file" id="audio-upload" accept="audio/*" />
              <span id="audio-file-name" class="file-name"
                >No file selected.</span
              >
            </div>

            <div class="musicians-toolkit">
              <h3>
                <i class="fa-solid fa-microphone-lines"></i> Musician's Toolkit
              </h3>
              <button id="analyze-btn" class="secondary-action" disabled>
                <i class="fa-solid fa-wand-magic-sparkles"></i> Analyze Audio
              </button>
              <div
                id="analysis-loader"
                class="loader-small"
                style="display: none"
              ></div>
              <div id="analysis-result" class="analysis-result hidden">
                <div class="result-item">
                  <strong><i class="fa-solid fa-gauge-high"></i> BPM</strong>
                  <span id="bpm-result"></span>
                </div>
                <div class="result-item">
                  <strong><i class="fa-solid fa-music"></i> Chords</strong>
                  <span id="chords-result"></span>
                </div>
              </div>
              <div class="metronome">
                <h4>Metronome</h4>
                <div class="metronome-controls">
                  <input
                    type="number"
                    id="metronome-bpm"
                    value="120"
                    min="40"
                    max="240"
                  />
                  <button id="metronome-toggle" class="tertiary-action">
                    <i class="fa-solid fa-play"></i>
                  </button>
                </div>
              </div>
            </div>
          </section>

          <section class="control-section">
            <h2 class="section-title">
              <span class="step-number">2</span> Add Your Image (Optional)
            </h2>
            <div class="control-group">
              <label for="image-upload" class="file-upload-label">
                <i class="fa-solid fa-image"></i> Choose Image File
              </label>
              <input type="file" id="image-upload" accept="image/*" />
              <div id="image-preview-container" class="image-preview-container hidden">
                <img id="image-preview" src="#" alt="Image Preview" />
                <div class="image-info">
                  <span id="image-file-name" class="file-name"></span>
                  <button id="clear-image-btn" title="Remove image">
                    <i class="fa-solid fa-xmark"></i>
                  </button>
                </div>
              </div>
            </div>
          </section>

          <section class="control-section">
            <h2 class="section-title">
              <span class="step-number">3</span> Create Your Visuals
            </h2>
            <div class="control-group">
              <label>Choose a Visual Template (Optional)</label>
              <div id="template-gallery" class="template-gallery">
                <!-- Templates will be dynamically inserted here by TS -->
              </div>
            </div>

            <div class="control-group">
              <label for="prompt-input"
                >Or Describe The Visuals Yourself</label
              >
              <div class="prompt-editor-container">
                <div class="prompt-toolbar">
                  <button id="prompt-bold-btn" type="button" title="Bold">
                    <i class="fa-solid fa-bold"></i>
                  </button>
                  <button id="prompt-italic-btn" type="button" title="Italic">
                    <i class="fa-solid fa-italic"></i>
                  </button>
                </div>
                <div class="prompt-textarea-wrapper">
                  <textarea
                    id="prompt-input"
                    rows="6"
                    placeholder="e.g., Add graffiti to the walls, or create a classic lowrider scene..."
                    maxlength="1000"
                  ></textarea>
                  <button
                    id="clear-prompt-btn"
                    type="button"
                    title="Clear prompt"
                    class="hidden"
                  >
                    <i class="fa-solid fa-xmark"></i>
                  </button>
                  <div
                    id="autocomplete-suggestions"
                    class="autocomplete-suggestions hidden"
                  ></div>
                </div>
                <div id="prompt-counter" class="prompt-counter">0 / 1000</div>
              </div>
            </div>

            <div class="control-group">
              <label for="style-select">Choose a Visual Style</label>
              <select id="style-select">
                <option value="cinematic" selected>Cinematic</option>
                <option value="street-art-graffiti">Street Art Graffiti</option>
                <option value="90s-vhs-camcorder">90s VHS Camcorder</option>
                <option value="gold-and-bling">Gold & Bling</option>
                <option value="vintage-film">Vintage Film</option>
                <option value="animated-doodles">Animated Doodles</option>
                <option value="surreal">Surreal</option>
                <option value="anime">Anime</option>
              </select>
            </div>

            <div class="control-group">
              <label>Select Video Resolution</label>
              <div class="radio-group">
                <input
                  type="radio"
                  id="resolution-720p"
                  name="resolution"
                  value="720p"
                  checked
                />
                <label for="resolution-720p">720p (HD)</label>
                <input
                  type="radio"
                  id="resolution-1080p"
                  name="resolution"
                  value="1080p"
                />
                <label for="resolution-1080p">1080p (FHD)</label>
              </div>
            </div>

            <div class="control-group">
              <label>Choose Video Type</label>
              <div class="radio-group">
                <input
                  type="radio"
                  id="video-type-visual"
                  name="video-type"
                  value="visual"
                  checked
                />
                <label for="video-type-visual">Visual Video</label>
                <input
                  type="radio"
                  id="video-type-lyrics"
                  name="video-type"
                  value="lyrics"
                />
                <label for="video-type-lyrics">Lyrics Video</label>
              </div>
            </div>

            <div id="lyrics-group" class="control-group hidden">
              <label for="lyrics-input">Add Your Lyrics</label>
              <textarea
                id="lyrics-input"
                rows="8"
                placeholder="Paste your song lyrics here..."
              ></textarea>
            </div>
          </section>

          <button id="generate-btn" class="primary-action" disabled>
            <i class="fa-solid fa-diamond"></i> Generate Video
          </button>
        </div>
        <div id="output-area" class="output-area">
          <div id="output-placeholder" class="output-placeholder">
            <div class="placeholder-icon-wrapper">
              <i class="fa-solid fa-clapperboard"></i>
            </div>
            <p>Your generated visuals will appear here.</p>
          </div>
          <div id="loader" class="loader" style="display: none">
            <div class="spinner"></div>
            <p id="loading-message">Initializing...</p>
          </div>
          <div id="video-result" class="video-result" style="display: none">
            <video id="video-player" controls></video>
            <div class="video-actions">
              <button id="download-video-btn" class="secondary-action">
                <i class="fa-solid fa-download"></i> Download Video
              </button>
              <p class="download-note">
                Note: The downloaded video will be silent. You can combine it
                with your audio using any video editing software.
              </p>
            </div>
          </div>
          <div id="image-result" class="image-result" style="display: none">
            <img id="image-viewer" alt="Generated image" />
            <div class="video-actions">
              <button id="download-image-btn" class="secondary-action">
                <i class="fa-solid fa-download"></i> Download Image
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>
    <audio id="audio-player" style="display: none"></audio>
    <script type="module" src="/index.tsx"></script>
  </body>
</html>